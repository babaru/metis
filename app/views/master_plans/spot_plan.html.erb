<div>

<%= render_page_title "<strong>#{@master_plan.project.client.name}</strong> #{@master_plan.project.name}: #{@master_plan.name}" do |toolbar|
  toolbar << {
    name: '生成文件',
    url: generate_spot_plan_path(master_plan_id: @master_plan),
    options: {
      method: :post,
      class: 'button button-primary'
    }
  }
  toolbar << {
    name: '保存排期表',
    url: save_spot_plan_path(master_plan_id: @master_plan),
    options: {
      method: :post,
      class: 'button button-success'
    }
  } if @master_plan.is_dirty
  toolbar << {
    name: "#{t('labels.back_to')}#{@master_plan.name}#{t('model.show', :model => MasterPlan.model_name.human)}",
    url: master_plan_path(@master_plan),
    options: {class: 'button'}
  }
end %>

<% if @candidate_websites %>

<article>
  <div class="padding">

    <ul class="nav nav-tabs">
      <% @candidate_websites.each do |website| %>
      <% if website.id == @selected_website_id.to_i %>
      <li class="active">
      <% else %>
      <li>
      <% end %>
        <%= link_to website.name, spot_plan_path(website_id: website.id, master_plan_id: @master_plan, m: @selected_month, y: @selected_year, wv: @working_version) %>
      </li>
      <% end %>
    </ul>

    <div class="well master-plan-summary">
      <%= render partial: 'master_plan_summary', locals: {contract_price: @master_plan.contract_price, website_contract_price: @master_plan.website_contract_price(@selected_website_id), profit: @master_plan.profit, website_profit: @master_plan.website_profit(@selected_website_id), run_time_on_house_rate: @master_plan.on_house_rate(@selected_website_id), standard_on_house_rate: @master_plan.project.client.on_house_rate(@selected_website_id), selected_website_id: @selected_website_id, master_plan_id: @master_plan.id, budget: @master_plan.project.budget} %>
    </div>

    <div class="grid">
      <div class="grid-row">
        <div class="cell6">
        </div>
        <div class="cell6">
          <div class="btn-group pull-right" data-toggle="buttons-radio">
            <% @months.each do |m| %>
            <%= link_to "#{m[:year]}年#{m[:month]}月", spot_plan_path(website_id: @selected_website_id, master_plan_id: @master_plan.id, y: m[:year], m: m[:month], wv: @working_version), class: (@selected_year == m[:year] && @selected_month == m[:month]) ? 'button active' : 'button' %>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <%= render partial: 'spot_plan_items_grid', locals: {spot_plan: @master_plan, selected_website_id: @selected_website_id} %>
  </div>

</article>

<div id="context-menu">
  <ul class="dropdown-menu" role="menu">
    <li><a tabindex="-1" href="#" class="modify_count" data-skip-pjax="true">调整数量</a></li>
  </ul>
</div>

<% end %>

</div>

<% content_for :js do %>
<% javascript_include_tag "spot_plan" %>
<% end %>
